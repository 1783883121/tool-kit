function clearTooltip(t){t.currentTarget.removeAttribute("data-content"),$(".markdown-body pre .btn").popover("hide")}function showTooltip(t,a){t.setAttribute("data-content",a),$(".markdown-body pre .btn").popover("show")}function fallbackMessage(t){var a="",e="cut"===t?"X":"C";return a=/iPhone|iPad/i.test(navigator.userAgent)?"No support :(":/Mac/i.test(navigator.userAgent)?"Press ⌘-"+e+" to "+t:"Press Ctrl-"+e+" to "+t}function setCookie(t,a,e){var i=new Date;i.setTime(i.getTime()+24*e*60*60*1e3);var n="expires="+i.toGMTString();document.cookie=t+"="+a+"; "+n}function getCookie(t){for(var a=t+"=",e=document.cookie.split(";"),i=0;i<e.length;i++){var n=e[i].trim();if(0==n.indexOf(a))return n.substring(a.length,n.length)}return""}function clearCookie(t){setCookie(t,"",-1)}$.ajaxSetup({localCache:!1});var ratingPage=1,$pluginData=window.Config.plugin,$ratingData=window.Config.rating;$(function(){loadRating(),openOperation();var t=location.hash.substr(1);$("#plugin-body-"+t).click(),$("#support_modal").on("show.bs.modal",function(){$(".preset-amount").show(),$(".custom-amount").hide(),$("#pay_amount").val($(".btn-pay-amount.active")[0].attributes["data-value"].value),setPayCh("wx_qr"),$(".btn-payment-method")[0].click()}),$(".btn-pay-amount").click(function(t){$(".btn-pay-amount.active").removeClass("active"),$("#pay_amount").val(t.target.attributes["data-value"].value),$(t.target).addClass("active")}),$(".preset-amount .custom a").click(function(t){$(".preset-amount").hide(),$(".custom-amount").show(),$("#pay_amount").val("")}),$(".btn-payment-method").click(function(t){$(".btn-payment-method.active").removeClass("active"),setPayCh(t.target.attributes["data-value"].value),$(t.target).addClass("active")});var a=document.querySelectorAll(".markdown-body pre");[].forEach.call(a,function(t){t.firstChild.insertAdjacentHTML("beforebegin",'<a class="btn" data-clipboard-snippet data-toggle="popover" data-placement="bottom" data-content="">复制代码</a>')});var e=new ClipboardJS("[data-clipboard-snippet]",{target:function(t){var a=t.nextElementSibling;return"CODE"!=a.nodeName&&(a=a.nextElementSibling),a}});e.on("success",function(t){t.clearSelection(),showTooltip(t.trigger,"已复制!")}),e.on("error",function(t){showTooltip(t.trigger,fallbackMessage(t.action))});for(var i=document.querySelectorAll(".markdown-body pre .btn"),n=0;n<i.length;n++)i[n].addEventListener("mouseleave",clearTooltip),i[n].addEventListener("blur",clearTooltip);$(".markdown-body pre .btn").popover({trigger:"manual"}),$(".plugin-body .preview-img").popover({trigger:"manual"}),hljs.configure({tabReplace:"    "}),hljs.initHighlightingOnLoad();var o=[".hmt-btn-hx-import",".hmt-btn-hx-import-example",".btn-download",".btn-download-example",".btn-buy"];for(var n in o)$(o[n]).click(function(t){HBuilderXImportEvent("弹出登录提示")})}),$("#plugin-item a").click(function(t){var a=t.currentTarget.attributes["data-id"].value;"tab_plugin_detail"==a?($("#tab_plugin_detail").addClass("active"),$("#tab_plugin_rating").removeClass("active"),$(".main-content .description").show(),$(".main-content .declaration").show(),location.hash="detail"):($("#tab_plugin_rating").addClass("active"),$("#tab_plugin_detail").removeClass("active"),location.hash="rating",$(".main-content .description").hide(),$(".main-content .declaration").hide())});var usage_hint=function(t,a){var e="",i="使用指南",n="知道了";if(2===$pluginData.category_level1)e='下载zip解压后，将文件按目录结构放入uni-app工程中。然后在页面里导入组件使用。具体参考 <a href="http://ask.dcloud.net.cn/article/35409" target="_blank">http://ask.dcloud.net.cn/article/35409</a>';else if(4===$pluginData.category_level1)e="解压到辅助类库目录下（比如 common 目录），然后在页面中 import 导入使用";else if(5===$pluginData.category_level1)e=1==t?"您已成功为项目"+a.appid+"（"+a.name+"）购买插件【"+$pluginData.name+"】。后续请在HBuilderX中打开该项目的manifest文件，并在“App原生插件配置”中配置，然后云打包生效。":0==t?"您已成功为项目"+a.appid+"（"+a.name+"）申请试用插件【"+$pluginData.name+"】，试用插件只能在自定义基座中使用。后续请在HBuilderX中打开该项目的manifest文件，并在“App原生插件配置”中配置，然后云打包生效。":'解压到uni-app应用的nativeplugins目录中。具体参考：<a href="https://ask.dcloud.net.cn/article/35412" target="_blank">https://ask.dcloud.net.cn/article/35412</a>';else if(3===$pluginData.category_level1)e="下载 zip 解压，将目录直接拖入 HBuilderX 中，即可打开这个项目。";else{if(7!==$pluginData.category_level1)return;n="导入到HBuilderX";var o="tcb"==a.provider?"腾讯云":"阿里云";1==t?(i="插件购买",e='您已成功为服务空间<span style="color:#22ac38;">'+a.name+"（"+o+'）</span>购买插件【<span style="color:#22ac38;">'+$pluginData.name+"</span>】。"):0==t&&(i="插件试用",e='您已成功为服务空间<span style="color:#22ac38;">'+a.name+"（"+o+'）</span>申请试用插件【<span style="color:#22ac38;">'+$pluginData.name+'</span>】。<br />试用插件有效期为<span style="color:#22ac38;">7</span>天。有效期截止 <span style="color:#22ac38;">'+a.resData.end_at+"</span>。<br />如需商用，请在插件市场正式购买。")}e+="<br><br>【友情提示】如果本插件对你有帮助, 请记得回来给作者5星好评和赞赏哟! ",BootstrapDialog.show({title:i,message:e,buttons:[{label:n,cssClass:"btn-primary",action:function(t){t.close(),7===$pluginData.category_level1?(tryAppList.push(a.id),setCookie("HBuilderXInstallHint",!0,365),download_plugin(1,0,a)):location.reload()}}]})},download_plugin=function(t,a,e,i){i="undefined"!=typeof i?i:1;var n;a?(n=$(".btn-download-example"),t&&(n=$(".btn-hx-import-example"))):(n=$(".btn-download"),t&&(n=$(".btn-hx-import")));var o={id:$pluginData.id,hx:t,ex:a,type:i};e&&(o.space_id=e.spaceId,o.provider=e.provider,o.space_name=e.name,o.type=e.buy_type),n.button("loading"),$.get("/plugin/download",o,function(o){0==o.ret?(canRating=!0,t?download_plugin_hx(o.data.url):(location.href=o.data.url,2==i?BootstrapDialog.alert("下载 zip 解压，将目录直接拖入 HBuilderX 中，即可打开这个项目!<br><br>【友情提示】如果本插件对你有帮助, 请记得回来给作者5星好评和赞赏哟! "):!a&&usage_hint()),n.button("reset")):3e3==o.ret?(download_plugin_captcha(t,a,e,i),n.button("reset")):(BootstrapDialog.alert(o.desc),n.button("reset"))})},download_plugin_captcha=function(t,a,e,i){i="undefined"!=typeof i?i:1;var n=$('<div class="form" style="margin-top: 15px;"></div>'),o=(new Date).getTime(),l="";l+='<div class="row">',l+='<div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">',l+='<input class="form-control" type="text" id="download_captcha" placeholder="验证码">',l+="</div>",l+='<div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 captcha">',l+='<img alt="点击换图" title="换一个" style="cursor:pointer" id="yw0" src="/captcha/download?t='+o+'">',l+='<a id="yw0_button" class="pull-right" href="#" style="margin-top: 8px;">换一个</a>',l+="</div>",l+="</div>",n.append(l),BootstrapDialog.show({title:"请输入验证码",message:n,onshown:function(t){$(document).on("click","#yw0_button, #yw0",function(){return $("#yw0").attr("src","/captcha/download?t="+(new Date).getTime()),$("#download_captcha").val(""),!1}),$("#download_captcha").focus()},buttons:[{label:"提交",cssClass:"btn-primary",autospin:!0,action:function(n){var o={id:$pluginData.id,verifycode:$("#download_captcha").val(),hx:t,ex:a,type:i};return o.verifycode?(e&&(o.space_id=e.spaceId,o.provider=e.provider,o.space_name=e.name),n.enableButtons(!1),n.setClosable(!1),void $.get("/plugin/download",o,function(e){0==e.ret?(n.close(),canRating=!0,t?download_plugin_hx(e.data.url):(location.href=e.data.url,2==i?BootstrapDialog.alert("下载 zip 解压，将目录直接拖入 HBuilderX 中，即可打开这个项目!<br><br>【友情提示】如果本插件对你有帮助, 请记得回来给作者5星好评和赞赏哟! "):!a&&usage_hint()),n.enableButtons(!0),n.setClosable(!0)):500==e.ret?($("#yw0")[0].click(),BootstrapDialog.alert(e.desc),n.enableButtons(!0),n.setClosable(!0),$(".modal-dialog span.icon-spin").removeClass("glyphicon-asterisk icon-spin")):(BootstrapDialog.alert(e.desc),n.enableButtons(!0),n.setClosable(!0),$(".modal-dialog span.icon-spin").removeClass("glyphicon-asterisk icon-spin"))})):(BootstrapDialog.alert("请输入验证码!"),void $(".modal-dialog span.icon-spin").removeClass("glyphicon-asterisk icon-spin"))}},{label:"取消",action:function(t){t.close()}}]})},download_plugin_hx=function(t){var a="HBuilderXInstallHint",e=getCookie(a);if(e)location.href=t;else{if(1==$pluginData.category_level1)var i='<h4>本功能依赖 HBuilderX 2.7 及以上版本。若确定已安装，请点继续。</h4><br><p>没有安装 HBuilderX ？<a href="https://www.dcloud.io/hbuilderx.html" target="_blank">点此获取最新版</a></p>';else if(7==$pluginData.category_level1){var i='<h4>本功能依赖 HBuilderX 2.7 及以上版本。若确定已安装，请点继续。</h4><br><p>没有安装 HBuilderX ？<a href="https://www.dcloud.io/hbuilderx.html" target="_blank">点此获取最新版</a></p>';if(73==$pluginData.category_level2)var i='<h4>本功能依赖 HBuilderX 2.9.2 及以上版本。若确定已安装，请点继续。</h4><br><p>没有安装 HBuilderX ？<a href="https://www.dcloud.io/hbuilderx.html" target="_blank">点此获取最新版</a></p>';else if(74==$pluginData.category_level2)var i='<h4>本功能依赖 HBuilderX 2.9.5 及以上版本。若确定已安装，请点继续。</h4><br><p>没有安装 HBuilderX ？<a href="https://www.dcloud.io/hbuilderx.html" target="_blank">点此获取最新版</a></p>'}else var i='<h4>本功能依赖 HBuilderX 1.9 及以上版本。若确定已安装，请点继续。</h4><br><p>没有安装 HBuilderX ？<a href="https://www.dcloud.io/hbuilderx.html" target="_blank">点此获取最新版</a></p>';BootstrapDialog.show({title:"提示",message:i,closable:!1,buttons:[{label:"取消",cssClass:"btn-default",action:function(t){t.close()}},{label:"继续",cssClass:"btn-primary",action:function(e){e.close(),setCookie(a,!0,365),location.href=t}}]})}},canRating=window.Config.canRating,validEmail=window.Config.validEmail,rating=function(){if(!canRating)return void BootstrapDialog.alert("请下载插件后再来评论!");if(!validEmail)return void BootstrapDialog.alert('当前账号邮箱未认证，请先前往 <a target="_blank" href="https://dev.dcloud.net.cn/">开发者后台</a> 完成邮箱认证后再来评论!');var t=$ratingData.score,a=$("#self_comment").text(),e=$('<div class="form"></div>');e.append('<div class="form-group">'),e.append('<input id="score" class="form-control" data-size="xs" data-min="0" data-max="5" data-step="1" value="'+t+'">'),e.append("</div>"),e.append('<div class="form-group">'),e.append('<textarea id="comment" class="form-control" rows="8" placeholder="最多2000字，支持 markdown 语法">'+a+"</textarea>"),e.append("</div>"),BootstrapDialog.show({title:"评论 - "+$pluginData.name,message:e,closeByKeyboard:!1,closeByBackdrop:!1,onshown:function(t){$("#score").rating({starCaptions:{1:"1分",2:"2分",3:"3分",4:"4分",5:"5分"},language:"cn",showCaption:!1,showClear:!1,animate:!1,min:1,max:5})},buttons:[{label:"提交",cssClass:"btn-primary",autospin:!0,action:function(t){var a={id:$ratingData.id,plugin_id:$pluginData.id,score:$("#score").val(),comment:$("#comment").val()};return 0==a.score?void BootstrapDialog.alert("还没有评分哦!"):(t.enableButtons(!1),void $.post("/plugin/rating",a,function(e){t.enableButtons(!0),0==e.ret?(setSupportStatus(a.score),location.reload(),t.close()):BootstrapDialog.alert(e.desc)}).fail(function(a){BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!"),t.enableButtons(!0)}))}},{label:"取消",action:function(t){t.close()}}]})},loadRating=function(){var t={plugin_id:$pluginData.id,page:ratingPage};$("#load_more").button("loading"),$.get("/plugin/rating",t,function(a){if(0==a.ret){var e=a.data;e.html||1!=t.page?($(".no-rating").hide(),$(".rating-content").show()):($(".no-rating").show(),$(".rating-content").hide()),$("#rating_list").append(e.html),ratingPage=e.page,e.more?($("#load_more").show(),$("#no_more").hide()):($("#load_more").hide(),$("#no_more").show()),bindReplyClick(),binEditReplyClick(),"function"==typeof bindDeleteRatingClick&&bindDeleteRatingClick()}$("#load_more").button("reset")}).fail(function(){$("#load_more").button("reset")})},bindReplyClick=function(){var t=$(".reply");t.unbind(),t.click(function(t){replyRating(t.target)})},binEditReplyClick=function(){var t=$(".edit-reply");t.unbind(),t.click(function(t){replyRating(t.target,"edit")})},replyRating=function(t,a){var e,i="";"edit"==a?(e=t.parentNode.parentNode.parentNode,i=t.parentNode.querySelector(".raw_comment").innerText):e=t.parentNode;var n=e.parentNode.parentNode,o=n.outerHTML,l=n.attributes["data-id"].value,s=$('<div class="form"></div>');s.append(o),s.append('<div class="form-group">'),s.append('<textarea id="reply" class="form-control" rows="8" placeholder="最多2000字，支持 markdown 语法">'+i+"</textarea>"),s.append("</div>"),BootstrapDialog.show({title:"插件作者回复",message:s,closeByKeyboard:!1,closeByBackdrop:!1,buttons:[{label:"提交",cssClass:"btn-primary",autospin:!0,action:function(t){var a={rating_id:l,plugin_id:$pluginData.id,reply:$("#reply").val()};return a.reply?(t.enableButtons(!1),void $.post("/plugin/rating-reply",a,function(a){t.enableButtons(!0),0==a.ret?(e.innerHTML=a.data.html,binEditReplyClick(),t.close()):(BootstrapDialog.alert(a.desc),t.enableButtons(!0))}).fail(function(t){BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!")})):void BootstrapDialog.alert("回复内容不能为空")}},{label:"取消",action:function(t){t.close()}}]})},setSupportStatus=function(t){if(t>3){var a=$pluginData.id+"_support_status";localStorage.setItem(a,1)}},openOperation=function(){var t=$pluginData.id+"_support_status",a=localStorage.getItem(t),e=window.Config.operation;if(a||"support"==e){var i=$(".banner-side .support .btn-support")[0];i&&i.click(),localStorage.removeItem(t)}else"rating"==e&&rating()},payChannel="ali_qr",setPayCh=function(t){payChannel=t},support=function(){var t={plugin_id:$pluginData.id,ch:payChannel,act:"support",amount:$("#pay_amount").val()};return t.amount<1||t.amount>1e4?void BootstrapDialog.alert("赞赏金额范围为 1-10000"):($("#support_modal .btn-support").button("loading"),void $.post("/payment/qr",t,function(a){0==a.ret?($("#support_modal").modal("hide"),pay(t.amount,a.data.order_id,a.data.qr_code)):BootstrapDialog.alert(a.desc),$("#support_modal .btn-support").button("reset")}).fail(function(t){401!=t.status&&(BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!"),$("#support_modal .btn-support").button("reset"))}))},tryFree=function(t,a,e){var i={plugin_id:$pluginData.id,type:a,appid:t.appid,app_name:t.name,android_package_name:t.android_package_name,ios_bundle_id:t.ios_bundle_id};$.post("/plugin/try-free",i,function(i){e&&e.close(),0==i.ret?usage_hint(a,t):BootstrapDialog.alert(i.desc)}).fail(function(t){e&&e.close(),401!=t.status&&BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!")})},buy=function(t,a,e){if(e&&e.close(),!window.Config.login)return void needLogin();if(window.Config.allowExtSellPolicy)choosePaymentMethod(t);else{var i=function(){var t=$('<div class="" style="height: 500px;"></div>'),a="";return a+='<iframe src="/ext_sell_policy.html" frameborder="" width="100%">',t.append(a),t};BootstrapDialog.show({title:"请先阅读付费插件使用协议",message:i(),cssClass:"app-list-dialog policy",closable:!1,buttons:[{label:"不同意",cssClass:"btn-default",action:function(t){t.close()}},{label:"同意",cssClass:"btn-primary",action:function(a){a.close(),choosePaymentMethod(t)}}]})}},choosePaymentMethod=function(t){BootstrapDialog.show({title:"请选择支付方式",message:function(t){setPayCh("ali_qr");var a=$('<div class="buy-plugin row" style="text-align: center"></div>'),e="";return e+='<div class="col-sm-offset-2 col-sm-4"><a class="btn btn-default active" data-value="ali_qr">支付宝</a></div>',e+='<div class="col-sm-4"><a class="btn btn-default" data-value="wx_qr">微信支付</a></div>',a.append(e),a.find(".btn").click(function(t){$(".buy-plugin .btn").removeClass("active"),setPayCh(t.target.attributes["data-value"].value),$(t.target).addClass("active")}),a},cssClass:"buy-dialog",buttons:[{label:"付款",cssClass:"btn-buy",action:function(a){var e=this;e.disable(),e.spin(),a.setClosable(!1);var i={plugin_id:$pluginData.id,ch:payChannel,act:"buy",amount:$pluginData.price,appid:t.appid,app_name:t.name,android_package_name:t.android_package_name,ios_bundle_id:t.ios_bundle_id};$.post("/payment/qr",i,function(t){e.enable(),e.stopSpin(),a.setClosable(!0),0==t.ret?(pay(i.amount,t.data.order_id,t.data.qr_code),a.close()):BootstrapDialog.alert(t.desc)}).fail(function(t){401!=t.status&&(BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!"),e.enable(),e.stopSpin(),a.setClosable(!0))})}}]})},spaceList=window.Config.appList,selectSpaceForFree=function(t,a){if(null==spaceList)return void needLogin();if(!spaceList.length)return void download_plugin(1,0);a||(a={id:spaceList[0].id,spaceId:spaceList[0].provider_space_id,name:spaceList[0].name,provider:spaceList[0].provider});var e="直接部署到您的服务空间",i=0,n="跳过",o=function(){var t=$('<div class="" style="max-height: 500px;"></div>'),e="";e+="<ul>";for(var o,l,s,c,r,d,p=0,u=spaceList.length;p<u;p++)o=spaceList[p].id,l=spaceList[p].provider_space_id,s=spaceList[p].name,c=spaceList[p].provider,r="tcb"==c?"腾讯云":"阿里云",d="",e+='<li class="'+d+'"data-id="'+o+'" data-spaceid="'+l+'" data-name="'+s+'"data-provider="'+c+'">'+s+" （"+r+"）</li>";return e+="</ul>",t.append(e),t.find("li").click(function(t){$(t.target).hasClass("active")?($(".app-list-dialog ul li").removeClass("active"),i=0,a.id="",a.spaceId="",a.name="",a.provider="",n="跳过",$("#confirm-btn").text(n)):($(".app-list-dialog ul li").removeClass("active"),a.id=t.target.attributes["data-id"].value,a.spaceId=t.target.attributes["data-spaceid"].value,a.name=t.target.attributes["data-name"].value,a.provider=t.target.attributes["data-provider"].value,$(t.target).addClass("active"),i=1,n="确认",$("#confirm-btn").text(n))}),t};BootstrapDialog.show({title:e,message:o(),cssClass:"app-list-dialog",closable:!1,buttons:[{label:'<a href="https://unicloud.dcloud.net.cn/" target="_blank">管理我的服务空间</a>',cssClass:"btn-my-app",action:function(t){}},{label:"取消",cssClass:"btn-default",action:function(t){a.id="",a.spaceId="",a.name="",a.provider="",t.close()}},{id:"confirm-btn",label:n,cssClass:"btn-primary",action:function(e){var n=this;n.disable(),n.spin(),e.setClosable(!1),i?selectSpaceForFreePreCheck(a,e,t):(e.close(),download_plugin(1,0))}}]})},selectSpaceForFreePreCheck=function(t,a,e){var i=function(){var a=$('<div class="" style="max-height: 500px;"></div>'),e="";e+='<div class="form-group">',e+='<div class="row">',e+='<div class="col-sm-12">',e+="<p><strong>是否直接部署本插件的云端部分到服务空间"+t.name+"</strong></p>",e+="</div>",e+='<div class="row">',e+='<div class="col-sm-12">',e+='<label class="checkbox-inline">',e+='<input type="checkbox" name="actions" id="checkbox-deployed-function" value="deployed"> 立即部署本插件的云函数到服务空间',e+="</label>",e+="</div>",e+="</div>";var i=$pluginData.db_init;0!=i&&(e+='<div class="row">',e+='<div class="col-sm-12">',e+='<label class="checkbox-inline">',e+='<input type="checkbox" name="actions" value="db_init"> 立即根据本插件包含的db_init.json初始化服务空间的数据库 &nbsp;&nbsp;',e+='<button class="btn btn-xs btn-primary" onclick="showDBInit()">查看</button>',e+="</label>",e+="</div>",e+="</div>");var n=$pluginData.function_init;return 0!=n&&(e+='<div class="row">',e+='<div class="col-sm-12">',e+='<label class="checkbox-inline">',e+='<input type="checkbox" name="actions" id="checkbox-deployed-function-init" disabled value="function_init"> 立即根据本插件包含的cloudfunctions_init.json初始化云函数配置 &nbsp;&nbsp;',e+='<button class="btn btn-xs btn-primary" onclick="showFunctionInit()">查看</button>',e+="</label>",e+="</div>",e+="</div>"),e+='<br /><div class="row">',e+='<div class="col-sm-12">',e+="<span>您也可以跳过本步骤，后续在HBuilderX中上传云函数和初始化数据库</span>",e+="</div>",e+="</div>",e+="</div>",a.append(e),a.find("#checkbox-deployed-function").click(function(t){$(t.target).is(":checked")?$("#checkbox-deployed-function-init").removeAttr("disabled"):($("#checkbox-deployed-function-init").attr("disabled",!0),$("#checkbox-deployed-function-init").removeAttr("checked"))}),a},n=3;a&&a.close(),BootstrapDialog.show({title:"提示",message:i(),buttons:[{label:"上一步",action:function(t){selectSpaceForFree(e),t.close()}},{label:"跳过",action:function(i){i.close(),t.isDeployed=0,e&&e(t,n,a)}},{label:"直接部署服务空间",disabled:!0,id:"free-deployed-btn",action:function(a){var i=0,o=0,l=0;if($("input[name='actions']:checked").each(function(){"deployed"==$(this).val()&&(i=1),"db_init"==$(this).val()&&(o=1),"function_init"==$(this).val()&&(l=1)}),!i&&!o)return void alert("请选择您要部署的内容。");$("#free-deployed-btn").text("正在部署中...");var s=this;if(s.disable(),s.spin(),t.dbInit=o,t.functionInit=l,i){var c={plugin_id:$pluginData.id,type:n,space_id:t.id,is_deployed:i};$.post("/plugin/check-space-function",c,function(i){0==i.ret?(t.isDeployed=1,e&&e(t,n,a)):5e3==i.ret?(a.close(),BootstrapDialog.show({title:"提示",message:'<div class="" style="max-height: 500px;overflow: auto;">'+i.desc+"</div>",closable:!1,buttons:[{label:"不覆盖",cssClass:"btn-default",action:function(i){i.close(),t.isDeployed=0,t.dbInit=0,t.functionInit=0,e&&e(t,n,a)}},{label:"覆盖并重新部署",cssClass:"btn-danger",id:"free-replace-deployed-btn",action:function(a){$("#free-replace-deployed-btn").text("正在部署中...");var i=this;i.disable(),i.spin(),t.isDeployed=1,e&&e(t,n,a)}}]})):6e3==i.ret?(a.close(),BootstrapDialog.alert({title:"提示",message:i.desc,buttonLabel:"确定",callback:function(a){download_plugin(1,0,t)}})):BootstrapDialog.alert(i.desc)})}else o?e&&e(t,n,a):(a.close(),download_plugin(1,0,t))}}]})},spaceDeployed=function(t,a,e){var i={plugin_id:$pluginData.id,space_id:t.id,is_dbinit:t.dbInit,is_deployed:t.isDeployed,is_funcinit:t.functionInit},n="云端部署成功。<br>是否将插件导入到HBuilderX？";t.dbInit||t.isDeployed||(n="云端部署无覆盖。<br>后续您可以在HBuilderX中上传云函数和初始化数据库，是否将插件导入到HBuilderX？"),$.post("/plugin/unicloud-deployed",i,function(i){if(0==i.ret){var o=i.data;o.ticket?checkUnicloudQueue(o.ticket,n,e,t):(e&&e.close(),BootstrapDialog.show({title:"提示",message:n,closable:!1,buttons:[{label:"取消",cssClass:"btn-default",action:function(t){t.close()}},{label:"继续导入",cssClass:"btn-primary",action:function(a){a.close(),download_plugin(1,0,t,t.buy_type)}}]}))}else 1===a&&e&&e.close(),BootstrapDialog.alert(i.desc)})},checkUnicloudQueue=function(t,a,e,i){var n={queue_id:t};$.post("/plugin/unicloud-queue-result",n,function(n){if(0===n.ret){var o=n.data;0===o.status?setTimeout(function(){checkUnicloudQueue(t,a,e,i)},1e3):1===o.status?(e&&e.close(),BootstrapDialog.show({title:"提示",message:a,closable:!1,buttons:[{label:"取消",cssClass:"btn-default",action:function(t){t.close()}},{label:"继续导入",cssClass:"btn-primary",action:function(t){t.close(),download_plugin(1,0,i)}}]})):(e&&e.close(),BootstrapDialog.show({title:"部署失败",message:o.log,buttons:[{label:"确定",cssClass:"btn-default",action:function(t){t.close()}}]}))}else e&&e.close(),BootstrapDialog.alert(n.desc)})},trialUniCloud=function(t){if(null==spaceList)return void needLogin();var a=function(){var t=$('<div class="" style="height: 500px;"></div>'),a="";return a+='<iframe src="/policy/unicloud_trial.html" frameborder="" width="100%">',t.append(a),t};BootstrapDialog.show({title:"付费插件试用协议",message:a(),cssClass:"app-list-dialog policy",closable:!1,buttons:[{label:"取消",cssClass:"btn-default",action:function(t){t.close()}},{label:"同意并继续",cssClass:"btn-default",action:function(a){a.close(),selectSpace(t)}}]})},selectSpace=function(t,a,e){if(e="undefined"!=typeof e?e:1,null==spaceList)return void needLogin();if(!spaceList.length){if($pluginData.platforms.indexOf("tcb")!==-1&&$pluginData.platforms.indexOf("aliyun")!==-1)var i="当前账号暂未创建服务空间";else if($pluginData.platforms.indexOf("tcb")!==-1&&$pluginData.platforms.indexOf("aliyun")===-1)var i="当前账号暂未创建腾讯云服务空间";else var i="当前账号暂未创建阿里云服务空间";return void BootstrapDialog.alert(i+'，请登录 <a target="_blank" href="https://unicloud.dcloud.net.cn/">https://unicloud.dcloud.net.cn</a> 创建服务空间后再来操作。<br />如果已创建，请刷新页面。')}a||(a={id:spaceList[0].id,spaceId:spaceList[0].provider_space_id,name:spaceList[0].name,provider:spaceList[0].provider}),a.buy_type=e;var n,o="",l="";t==spaceTryFree?(n=0,o="您要为哪个服务空间绑定本插件的试用？",l+="<p>",l+="<strong>注意事项：</strong><br>",l+="1、付费云函数以加密方式存在，可试用，试用有效期为7天。7天后加密的云函数将无法继续在绑定的服务空间运行。试用结束后5天内不可再次申请试用，超过5天后，可重新申请试用。<br>",l+="2、申请试用后，您可选择是否自动上传部署到服务空间，部署过程需要一定时间。<br>",l+="</p>"):(n=1,o=2==e?"您要为哪个服务空间购买本插件的源码授权版？":"您要为哪个服务空间购买本插件的普通授权版？",l+="<p>",l+="<strong>注意事项：</strong><br>",l+='1、了解“普通授权版”和“源码授权版”的区别，另见<a href="https://ask.dcloud.net.cn/article/38040" target="_blank">https://ask.dcloud.net.cn/article/38040</a><br>',l+="2、一次购买仅用于一个服务空间，可为多个服务空间重复购买。<br>",l+="3、购买成功后，您可选择是否自动上传部署到服务空间，部署过程需要一定时间。<br>",l+="</p>");var s=function(){var t=$('<div class="" style="max-height: 500px;"></div>'),e="";e+=l,e+="<ul>";for(var i,n,o,s,c,r,d=0,p=spaceList.length;d<p;d++)i=spaceList[d].id,n=spaceList[d].provider_space_id,o=spaceList[d].name,s=spaceList[d].provider,c="tcb"==s?"腾讯云":"阿里云",r=a.spaceId===n?"active":"",e+='<li class="'+r+'"data-id="'+i+'" data-spaceid="'+n+'" data-name="'+o+'"data-provider="'+s+'">'+o+" （"+c+"）</li>";return e+="</ul>",t.append(e),t.find("li").click(function(t){$(".app-list-dialog ul li").removeClass("active"),a.id=t.target.attributes["data-id"].value,a.spaceId=t.target.attributes["data-spaceid"].value,a.name=t.target.attributes["data-name"].value,a.provider=t.target.attributes["data-provider"].value,$(t.target).addClass("active")}),t},c="确认";BootstrapDialog.show({title:o,message:s(),cssClass:"app-list-dialog",closable:!1,buttons:[{label:'<a href="https://unicloud.dcloud.net.cn/" target="_blank">管理我的服务空间</a>',cssClass:"btn-my-app",action:function(t){}},{label:'<div style="margin-left: 15px"><input type="checkbox" checked id="agree-usage-policy"></div>',cssClass:"btn-my-app",action:function(t){var a=document.getElementById("agree-usage-policy").checked;a?t.getButton("confirm-btn").enable():t.getButton("confirm-btn").disable()}},{label:'<a href="javascript:void(0)">同意《付费插件使用协议》(更新于2020.11.7)</a>',cssClass:"btn-my-app",action:function(t){var a=function(){var t=$('<div class="" style="height: 500px;"></div>'),a="";return a+='<iframe src="/ext_sell_policy.html" frameborder="" width="100%">',t.append(a),t};BootstrapDialog.show({title:"付费插件使用协议",message:a(),cssClass:"app-list-dialog policy",closable:!1,buttons:[{label:"关闭",cssClass:"btn-default",action:function(t){t.close()}}]})}},{label:"取消",cssClass:"btn-default",action:function(t){a.id="",a.spaceId="",a.name="",a.provider="",t.close()}},{id:"confirm-btn",label:c,cssClass:"btn-primary",action:function(i){var o=this;o.disable(),o.spin(),i.setClosable(!1),checkSpace(a,n,i,t,e)}}]})},boughtSpaceList=window.Config.boughtAppList,trySpaceList=window.Config.tryAppList,checkSpace=function(t,a,e,i,n){n="undefined"!=typeof n?n:1;var o=t.id+"",l=0,s=0;return 0==a?(boughtSpaceList.indexOf(o)!==-1&&(l=1,s=1),trySpaceList.indexOf(o)!==-1&&(l=1)):boughtSpaceList.indexOf(o)!==-1&&(l=1,s=1),1===l?redoDeployed(t,s,e,i,n):i===spaceTryFree?spacePrePay(t,a,e,i):(t.isDeployed=0,t.dbInit=0,spaceBuy(t,e)),!0},redoDeployed=function(t,a,e,i,n){if(n="undefined"!=typeof n?n:1,0===a)var o="当前服务空间已申请试用该插件，请选择您要执行的操作？";else var o="当前服务空间已购买该插件，请选择您要执行的操作？";if(2==t.buy_type)return BootstrapDialog.alert("当前服务空间已购买普通授权版，不可在购买源码授权版，请选择其他服务空间"),e.indexedButtons["confirm-btn"].enable(),e.indexedButtons["confirm-btn"].stopSpin(),void e.setClosable(!0);var l="重新部署",s="导入到HBuilderX";BootstrapDialog.show({title:"提示",message:o,closable:!1,buttons:[{label:"取消",cssClass:"btn-default",action:function(t){e.indexedButtons["confirm-btn"].enable(),e.indexedButtons["confirm-btn"].stopSpin(),e.setClosable(!0),t.close()}},{label:s,cssClass:"btn-default",action:function(a){e.close(),a.close(),download_plugin(1,0,t,n)}},{label:l,cssClass:"btn-default",action:function(n){n.close(),spacePrePay(t,a,e,i,1)}}]})},showFunctionInit=function(){var t=$("#plugin_functioninit_content").val(),a=$('<div class="form"></div>');a.append('<div class="form-group">'),a.append('<textarea id="markdown" class="form-control" rows="20" placeholder="">'+t+"</textarea>"),a.append("</div>"),BootstrapDialog.show({title:"cloudfunctions_init 内容",message:a,cssClass:"dbinit_dialog",buttons:[{label:"取消",action:function(t){t.close()}}]})},showDBInit=function(){var t=$("#plugin_dbinit_content").val(),a=$('<div class="form"></div>');a.append('<div class="form-group">'),a.append('<textarea id="markdown" class="form-control" rows="20" placeholder="">'+t+"</textarea>"),a.append("</div>"),BootstrapDialog.show({title:"db_init 内容",message:a,cssClass:"dbinit_dialog",buttons:[{label:"关闭",action:function(t){t.close()}}]})},spacePrePay=function(t,a,e,i,n){var o=function(){var e=$('<div class="" style="max-height: 500px;"></div>'),i="",n=1===a?"插件已购买成功，是否直接部署本插件的云端部分到服务空间"+t.name+"？":"是否直接部署本插件的云端部分到服务空间"+t.name+"？";i+='<div class="form-group">',i+='<div class="row">',i+='<div class="col-sm-12">',i+="<p><strong>"+n+"</strong></p>",i+="</div>",i+="</div>",i+='<div class="row">',i+='<div class="col-sm-12">',i+='<label class="checkbox-inline">',i+='<input type="checkbox" name="actions" id="checkbox-deployed-function" value="deployed"> 立即部署本插件的云函数到服务空间',i+="</label>",i+="</div>",i+="</div>";var o=$pluginData.db_init;0!=o&&(i+='<div class="row">',i+='<div class="col-sm-12">',i+='<label class="checkbox-inline">',i+='<input type="checkbox" name="actions" value="db_init"> 立即根据本插件包含的db_init.json初始化服务空间的数据库 &nbsp;&nbsp;',i+='<button class="btn btn-xs btn-primary" onclick="showDBInit()">查看</button>',i+="</label>",i+="</div>",i+="</div>");var l=$pluginData.function_init;return 0!=l&&(i+='<div class="row">',i+='<div class="col-sm-12">',i+='<label class="checkbox-inline">',i+='<input type="checkbox" name="actions" id="checkbox-deployed-function-init" disabled value="function_init"> 立即根据本插件包含的cloudfunctions_init.json初始化云函数配置 &nbsp;&nbsp;',i+='<button class="btn btn-xs btn-primary" onclick="showFunctionInit()">查看</button>',i+="</label>",i+="</div>",i+="</div>"),i+='<br /><div class="row">',i+='<div class="col-sm-12">',i+="<span>您也可以跳过本步骤，后续在HBuilderX中上传云函数和初始化数据库</span>",i+="</div>",i+="</div>",i+="</div>",e.append(i),e.find("#checkbox-deployed-function").click(function(t){$(t.target).is(":checked")?$("#checkbox-deployed-function-init").removeAttr("disabled"):($("#checkbox-deployed-function-init").attr("disabled",!0),$("#checkbox-deployed-function-init").removeAttr("checked"))}),e},l=1===a?"插件购买":"插件试用";e&&e.close(),BootstrapDialog.show({title:l,closable:!0,message:o(),onshow:function(t){1!==a||n||t.getButton("prepay-prev-btn").css("display","none")},buttons:[{id:"prepay-prev-btn",label:"上一步",action:function(a){selectSpace(i,t),a.close()}},{label:"跳过",action:function(o){o.close(),i&&i===spaceTryFree&&o.close(),n?spaceDeployed(t,a,e):(t.isDeployed=0,i&&i(t,a,e))}},{label:"直接部署服务空间",id:"prepay-deployed-btn",action:function(o){var l=0,s=0,c=0;if($("input[name='actions']:checked").each(function(){"deployed"==$(this).val()&&(l=1),"db_init"==$(this).val()&&(s=1),"function_init"==$(this).val()&&(c=1)}),!l&&!s)return void alert("请选择您要部署的内容。");$("#prepay-deployed-btn").text("正在部署中...");var r=this;r.disable(),r.spin(),t.dbInit=s,t.functionInit=c;var d=i&&i===spaceTryFree?e:o;if(l){var p={plugin_id:$pluginData.id,type:a,space_id:t.id,is_deployed:l};1===a&&(p.is_ck_bought=0),n&&(p.is_ck_try=0),$.post("/plugin/check-space-function",p,function(e){i&&i===spaceTryFree&&o.close(),0==e.ret?(t.isDeployed=1,n?spaceDeployed(t,a,d):i&&i(t,a,d)):5e3==e.ret?(o.close(),BootstrapDialog.show({title:"提示",message:'<div class="" style="max-height: 500px; overflow: auto">'+e.desc+"</div>",closable:!0,buttons:[{label:"不覆盖",cssClass:"btn-default",action:function(e){e.close(),t.isDeployed=0,t.dbInit=0,t.functionInit=0,n?spaceDeployed(t,a,d):i&&i(t,a,d)}},{label:"覆盖并重新部署",cssClass:"btn-danger",id:"replace-deployed-btn",action:function(e){$("#replace-deployed-btn").text("正在部署中...");var o=this;o.disable(),o.spin(),t.isDeployed=1,n?spaceDeployed(t,a,e):i&&i(t,a,e)}}]})):6e3==e.ret?BootstrapDialog.alert({title:"提示",message:e.desc,buttonLabel:"确定",callback:function(e){t.isDeployed=0,t.functionInit=0,n?spaceDeployed(t,a,d):i&&i(t,a,d)}}):BootstrapDialog.alert(e.desc)})}else i&&i===spaceTryFree&&!n&&o.close(),t.isDeployed=0,t.functionInit=0,n?spaceDeployed(t,a,o):i&&i(t,a,d)}}]})},spaceTryFree=function(t,a,e){var i={plugin_id:$pluginData.id,type:a,space_id:t.id,buy_type:1,is_deployed:t.isDeployed,is_dbinit:t.dbInit,is_funcinit:t.functionInit};$.post("/plugin/try-free",i,function(i){e&&e.close(),0==i.ret?(t.resData=i.data,trySpaceList.push(t.id+""),usage_hint(a,t)):BootstrapDialog.alert(i.desc)}).fail(function(t){e&&e.close(),401!=t.status&&BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!")})},spaceBuy=function(t,a){return a&&a.close(),window.Config.login?void spacePayment(t):void needLogin()},spacePayment=function(t){BootstrapDialog.show({title:"请选择支付方式",message:function(t){setPayCh("ali_qr");var a=$('<div class="buy-plugin row" style="text-align: center"></div>'),e="";return e+='<div class="col-sm-offset-2 col-sm-4"><a class="btn btn-default active" data-value="ali_qr">支付宝</a></div>',
e+='<div class="col-sm-4"><a class="btn btn-default" data-value="wx_qr">微信支付</a></div>',a.append(e),a.find(".btn").click(function(t){$(".buy-plugin .btn").removeClass("active"),setPayCh(t.target.attributes["data-value"].value),$(t.target).addClass("active")}),a},cssClass:"buy-dialog",buttons:[{label:"付款",cssClass:"btn-buy",action:function(a){var e=this;e.disable(),e.spin(),a.setClosable(!1);var i=t.buy_type?t.buy_type:1,n=$pluginData.price;2==i&&(n=$pluginData.code_price);var o={plugin_id:$pluginData.id,ch:payChannel,act:"buy",amount:n,space_id:t.id,buy_type:i,is_deployed:t.isDeployed,is_dbinit:t.dbInit};$.post("/payment/qr",o,function(t){e.enable(),e.stopSpin(),a.setClosable(!0),0==t.ret?(pay(t.data.amount,t.data.order_id,t.data.qr_code),a.close()):BootstrapDialog.alert(t.desc)}).fail(function(t){401!=t.status&&(BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!"),e.enable(),e.stopSpin(),a.setClosable(!0))})}}]})},appList=window.Config.appList,selectApp=function(t,a,e,i){if(null==appList)return void needLogin();if(!appList.length)return void BootstrapDialog.alert("此插件只适用于 uni-app 项目，请创建 uni-app 项目后再来操作。如果已创建项目，请刷新页面。");i||(i={appid:appList[0].appid,name:appList[0].name});var n,o="",l="";t==tryFree&&0==e?(n=0,o="您要为哪个项目绑定本插件的试用？",l+="<p>",l+="<strong>注意事项：</strong><br>",l+='1、试用只能用于打包 <a href="http://ask.dcloud.net.cn/article/35115" target="_blank">自定义基座</a>，不能用于正式发布。试用没有有效期限制。<br>',l+="</p>"):(n=1,o="您要为哪个项目购买本插件？",l+="<p>",l+="<strong>注意事项：</strong><br>",l+="1、一次购买仅用于一个项目。仅与项目有关，与项目有几位开发者无关。<br>",l+="2、购买后，在HBuilderX中打开该项目的manifest文件，并在“App原生插件配置”中配置，然后云打包生效。<br>",l+=$pluginData.price?"3、暂不支持离线打包集成付费原生插件。":"3、离线打包无需绑定项目，请自行下载Zip包集成。",l+="</p>");var s=function(){var t=$('<div class="" style="max-height: 500px;"></div>'),a="";a+=l,a+="<ul>";for(var e,n,o,s=0,c=appList.length;s<c;s++)e=appList[s].appid,n=appList[s].name,o=i.appid===e?"active":"",a+='<li class="'+o+'" data-appid="'+e+'" data-name="'+n+'">'+e+" （"+n+"）</li>";return a+="</ul>",t.append(a),t.find("li").click(function(t){$(".app-list-dialog ul li").removeClass("active"),i.appid=t.target.attributes["data-appid"].value,i.name=t.target.attributes["data-name"].value,$(t.target).addClass("active")}),t},c="确认";a&&(c="下一步"),BootstrapDialog.show({title:o,message:s(),cssClass:"app-list-dialog",closable:!1,buttons:[{label:'<a href="https://dev.dcloud.net.cn/app/index?type=0" target="_blank">管理我的APP</a>',cssClass:"btn-my-app",action:function(t){}},{label:'<div style="margin-left: 15px"><input type="checkbox" checked id="agree-usage-policy"></div>',cssClass:"btn-my-app",action:function(t){var a=document.getElementById("agree-usage-policy").checked;a?t.getButton("confirm-btn").enable():t.getButton("confirm-btn").disable()}},{label:'<a href="javascript:void(0)">同意《付费插件使用协议》(更新于2020.11.7)</a>',cssClass:"btn-my-app",action:function(t){var a=function(){var t=$('<div class="" style="height: 500px;"></div>'),a="";return a+='<iframe src="/ext_sell_policy.html" frameborder="" width="100%">',t.append(a),t};BootstrapDialog.show({title:"付费插件使用协议",message:a(),cssClass:"app-list-dialog policy",closable:!1,buttons:[{label:"关闭",cssClass:"btn-default",action:function(t){t.close()}}]})}},{label:"取消",cssClass:"btn-default",action:function(t){i.appid="",i.name="",t.close()}},{id:"confirm-btn",label:c,cssClass:"btn-primary",action:function(o){var l=checkApp(i,n);if(l!==!0)return void BootstrapDialog.alert(l);if(a){o.close();var s={appid:i.appid,pluginId:$pluginData.id};$.post("/plugin/app-package",s,function(a){0==a.ret?bindAppPackage(t,e,i,a.data):BootstrapDialog.alert(a.desc)})}else{var c=this;c.disable(),c.spin(),o.setClosable(!1),t&&t(i,e,o)}}}]})},bindAppPackage=function(t,a,e,i){var n=function(){var t=$('<div class="" style="max-height: 500px;"></div>'),a="";if(a+="<p>",a+='<strong>提示：</strong>云打包时会校验Appid、包名和已购买插件的关系。至少需要填一个，如果暂不填，后续可以在"已购买插件"栏目补填。<br>',a+="<strong>特别注意：</strong><br>",a+="<strong>1. 包名一旦绑定后将不能修改，请务必注意在此处输入的包名应与打包时的包名完全一致！</strong><br>",a+="<strong>2. 使用HBuilderX 2.7.14以下版本，如果同一插件且同一appid下购买并绑定了多个包名，提交云打包界面提示包名绑定不一致时，需要在HBuilderX项目中manifest.json->“App原生插件配置”->”云端插件“列表中删除该插件重新选择</strong>",a+="</p>",a+='<div class="form-horizontal">',i.buyPackageList.length){a+='<div class="form-group">',a+='<label class="col-sm-3 control-label">已购买的包名：</label>',a+='<div class="col-sm-7 npl" style="max-height:200px; overflow: auto;">';for(var e=0,n=i.buyPackageList.length;e<n;e++)a+="<span>"+i.buyPackageList[e].name+"（"+i.buyPackageList[e].type+"）</span><br />";a+="</div>",a+="</div>"}return a+='<div class="form-group">',a+='<label for="android_pn" class="col-sm-3 control-label">Android 包名：</label>',a+='<div class="col-sm-7 npl">',a+='<select id="appid_package_android" style="width:100%"><option value="" selected="selected">请选择或输入新的包名</option></select>',a+="</div>",a+="</div>",a+='<div class="form-group">',a+='<label for="ios_bundle_id" class="col-sm-3 control-label">iOS 包名：</label>',a+='<div class="col-sm-7 npl">',a+='<select id="appid_package_ios" style="width:100%"><option value="" selected="selected">请选择或输入新的包名</option></select>',a+="</div>",a+="</div>",a+="</div>",t.append(a),t};BootstrapDialog.show({title:"请绑定包名",message:n(),cssClass:"app-list-dialog",closable:!1,onshown:function(){$("#appid_package_android").select2({dropdownParent:$(".app-list-dialog"),tags:i.packageList.android}),$("#appid_package_ios").select2({dropdownParent:$(".app-list-dialog"),tags:i.packageList.ios})},buttons:[{label:"取消",cssClass:"btn-default",action:function(t){e.appid="",e.name="",e.android_package_name="",e.ios_bundle_id="",t.close()}},{label:"上一步",cssClass:"btn-primary",action:function(i){i.close(),selectApp(t,1,a,e)}},{label:"下一步",cssClass:"btn-primary",action:function(i){var n=$("#appid_package_android").select2("val"),o=$("#appid_package_ios").select2("val");if(!n&&!o)return void BootstrapDialog.alert("Android包名或iOS BundleID至少需要填一个！");if(n&&!checkAndroidPn(n))return void BootstrapDialog.alert("Android 包名不合法，推荐使用反向域名格式，示例: “com.domainname.appname”，需要包含至少两个“.”，只能使用数字、字母、下划线，且以“.”分隔的每一段只能以字母开头。不要使用java的关键字符，如default、new、delete等。");if(o&&!checkIosPn(o))return void BootstrapDialog.alert("iOS BundleID/Apple Appid 不合法，推荐使用反向域名格式，示例: “com.domainname.appname”，需要包含至少两个“.”，并且只能使用数字、字母、短横线。");var l=this,s="<strong>请确认以下绑定包名是否正确，付费插件绑定后将无法修改：</strong><br><br>";n&&(s+="<strong>Android 包名："+n+"</strong><br>"),o&&(s+="<strong>iOS 包名："+o+"</strong>"),BootstrapDialog.confirm(s,function(s){s&&(l.disable(),l.spin(),i.setClosable(!1),e.android_package_name=n,e.ios_bundle_id=o,t&&t(e,a,i))})}}]})},pay=function(t,a,e){var i=$('<div class="" style="text-align: center"></div>'),n="";"wx_qr"==payChannel?(n+="<h3>微信扫码支付</h3>",n+='<img src="'+e+'" style="width: 200px; height: 200px">'):"ali_qr"==payChannel&&(n+="<h3>支付宝扫码支付</h3>",n+='<iframe src="'+e+'" width="200px" height="210px" frameborder="none"></iframe>'),n+='<p>支付金额 <span class="amount">￥'+t+"</span></p>",i.append(n),BootstrapDialog.show({title:"",message:i,cssClass:"pay-dialog",onshown:function(t){checkOrder(a,t)},buttons:[]})},checkOrder=function(t,a){var e={order_id:t,payChannel:payChannel};$.post("/payment/check-order",e,function(e){if(0==e.ret){var i=e.data;if("NOTPAY"==i)$(".pay-dialog").length&&setTimeout(function(){checkOrder(t,a)},1e3);else if("SUCCESS"==i){a.close();var n=e.type;if("buy"==n){if(e.buy_type){var o=e.space;return o.buy_type=e.buy_type,boughtSpaceList.push(o.id+""),void spacePrePay(o,1,null,spaceDeployed)}BootstrapDialog.alert("您已成功为项目"+e.appid+"（"+e.name+"）购买插件【"+$pluginData.name+"】。后续请在HBuilderX中打开该项目的manifest文件，并在“App原生插件配置”中配置，然后云打包生效。")}else BootstrapDialog.alert("支付成功, 感谢你对插件作者的支持!");location.reload()}else a.close(),BootstrapDialog.alert("支付失败, 请重新支付!")}else a.close(),BootstrapDialog.alert(e.desc)}).fail(function(){$(".pay-dialog").length&&setTimeout(function(){checkOrder(t,a)},1e3)})},boughtAppList=window.Config.boughtAppList,tryAppList=window.Config.tryAppList,checkApp=function(t,a){if(0==a){if(boughtAppList.indexOf(t.appid)!==-1)return"项目"+t.appid+"（ "+t.name+" ）已购买此插件, 无需申请试用。请到“我的插件”-“我使用的插件”-“购买的插件”列表中查看。";if(tryAppList.indexOf(t.appid)!==-1)return"项目"+t.appid+"（ "+t.name+" ）已申请试用此插件, 无需重复申请。请到“我的插件”-“我使用的插件”-“购买的插件”列表中查看。"}return!0},checkAndroidPn=function(t){if(!t)return!1;var a=t.split(".");if(a.length<2)return!1;for(var e in a){var i=a[e];if(!i.match(/^[a-zA-Z]/i)||!i.match(/^\w+$/))return!1}return!0},checkIosPn=function(t){if(!t)return!1;var a=t.split(".");if(a.length<2)return!1;for(var e in a){var i=a[e];if(!i.match(/^[a-zA-Z0-9\-]+$/))return!1}return!0},collection=function(t){if(!window.Config.login)return void gotoLogin("like");var a={plugin_id:$pluginData.id,type:1,total:1};$(t).attr("disabled")||($(t).attr("disabled",!0),$.post("/plugin/follow",a,function(a){if($(t).removeAttr("disabled"),0===a.ret){var e=a.data.follow,i=a.data.total;$(t).find(".collection-text").text(i);var n=1===e?"//img-cdn-aliyun.dcloud.net.cn/dev/img/ext/collection-small.png":"//img-cdn-aliyun.dcloud.net.cn/dev/img/ext/collection-small-empty.png";$(t).find("img").attr("src",n)}else BootstrapDialog.alert(a.desc)}).fail(function(a){$(t).removeAttr("disabled"),BootstrapDialog.alert("服务器繁忙, 请刷新页面后重试!")}))},HBuilderXImportEvent=function(t){var a="HBuilderXImportEvent";if(window.Config.login){var e="已登录";if(t="成功",""===getCookie(a))return;clearCookie(a)}else{var e="未登录";setCookie(a,!0,365)}var i="插件下载";_hmt.push(["_trackEvent",i,e,t])};